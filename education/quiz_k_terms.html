<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thermo-Credit K terms drill (EN) | ToppyMicroServices</title>
  <meta name="description" content="Thermo-Credit glossary drill for K1‚ÄìK19 (CET1 slack, credit capacity, hysteresis, early warning). Mixed MC, multi-select, and text prompts with learning mode." />
  <link rel="canonical" href="https://toppymicros.com/education/quiz_k_terms.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ToppyMicroServices ‚Äî Thermo-Credit & AI Reliability" />
  <meta property="og:description" content="Open math + dashboards for credit allocation (Thermo-Credit) and AI reliability." />
  <meta property="og:url" content="https://toppymicros.com/education/quiz_k_terms.html" />
  <meta property="og:image" content="https://toppymicros.com/og-brand-clean.png" />
  <meta property="og:site_name" content="ToppyMicroServices" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ToppyMicroServices ‚Äî Thermo-Credit & AI Reliability" />
  <meta name="twitter:description" content="Open math + dashboards for credit allocation (Thermo-Credit) and AI reliability." />
  <meta name="twitter:image" content="https://toppymicros.com/og-brand-clean.png" />
  <link rel="alternate" hreflang="en" href="quiz_k_terms.html" />
  <link rel="alternate" hreflang="ja" href="quiz_k_terms_ja.html" />
  <link rel="stylesheet" href="quiz.css" />
  <script defer data-domain="toppymicros.com" data-auto="false" src="https://plausible.io/js/script.tag"></script>
  <script defer src="../assets/global.js"></script>
</head>
<body data-theme="dark">
  <script>
    window.DRILL_SETTINGS = {
      SKILL_NAME: "Thermo-Credit Glossary",
      SKILL_SUBTITLE: "K Terms (Foundational Concepts)",
      GOAL_DESCRIPTION: "Recall and explain each K# concept with intuition",
      LEARNING_MODE_DEFAULT: true,
      BRAND_NAME: "ToppyMicroServices",
      BRAND_LOGO: "og-brand-clean.min.png",
      BRAND_URL: "../index.html"
    };
  </script>
  <div class="container">
    <header>
      <div>
        <div class="brand">
          <a id="brand-link" href="../index.html" aria-label="Home">
            <img id="brand-logo" alt="ToppyMicroServices logo" src="og-brand-clean.min.png" width="40" height="40" style="display:inline-block">
            <span id="brand-name" class="name">ToppyMicroServices</span>
          </a>
        </div>
        <h1 id="title">Thermo-Credit Glossary Drill: K Terms</h1>
        <h2 id="subtitle">Practice mapping from K# markers to formal definitions & intuition</h2>
      </div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <button type="button" class="theme-toggle" id="themeToggle" aria-pressed="false">üåû Light</button>
        <div class="lang-toggle" aria-label="Language switcher">
          <a href="quiz_k_terms.html" class="active" aria-current="page">English</a>
          <a href="quiz_k_terms_ja.html">Êó•Êú¨Ë™û</a>
        </div>
        <button type="button" class="badge clickable" id="mode-badge" aria-live="polite" aria-pressed="true" title="Toggle learning/test mode">Learning Mode</button>
        <span id="score-badge" aria-live="polite" title="Live Score">0 / 0</span>
      </div>
    </header>

    <section class="card scope" aria-labelledby="scope-h">
      <h3 id="scope-h">Scope</h3>
      <ul>
        <li><strong>Goal:</strong> Fast recall of each K# term and ability to explain context.</li>
        <li><strong>Methods:</strong> Mixed question types (MC, multi-select, classify, short text).</li>
      </ul>
    </section>

    <details class="cheatsheet card">
      <summary>Cheat Sheet (reference)</summary>
      <div class="sheet">
        <ul>
          <li>K1 CET1: Core equity capital absorbing losses.</li>
          <li>K2 RWA: Risk-weighted assets measuring exposure adjusted for risk.</li>
          <li>K3 CET1/RWA Slack: Excess above minimum regulatory capital ratio.</li>
          <li>K4 Credit Capacity (V_C): Headroom for additional lending.</li>
          <li>K5 Credit Pressure (p_C): Shadow price of capacity.</li>
          <li>K6 HQLA: High Quality Liquid Assets.</li>
          <li>K7 Liquidity Buffer: Reserve for stress outflows.</li>
          <li>K8 LCR: 30-day liquidity coverage ratio.</li>
          <li>K9 NSFR: One-year stable funding ratio.</li>
          <li>K10 Money-in-circulation: Operational circulating money measure.</li>
          <li>K11 Credit Stocks & Flows: Outstanding vs period changes.</li>
          <li>K12 Margin Credit: Credit financing securities positions.</li>
          <li>K13 Commercial Paper (CP): Short-term unsecured corporate debt.</li>
          <li>K14 Policy Work (W_policy): Structured regulatory/government interventions.</li>
          <li>K15 MECE: Mutually Exclusive Collectively Exhaustive partition principle.</li>
          <li>K16 State Variable & Proxy: Path-independent quantity approximated by observable metrics.</li>
          <li>K17 Hysteresis & Loop Area: Irreversibility in state cycles.</li>
          <li>K18 Stress Testing & Early Warning: Scenario robustness + fragility detection tools.</li>
          <li>K19 Money vs Credit Perspective: Credit creation primacy in QTC vs classic QTM.</li>
        </ul>
      </div>
    </details>

    <section id="questions">
      <article class="q card" data-id="K1" data-type="mc" data-answer="b">
        <header><h4>K1: Best description of CET1</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K1" value="a"> A. Short-term wholesale funding</label>
            <label class="choice"><input type="radio" name="K1" value="b"> B. Core equity capital absorbing losses</label>
            <label class="choice"><input type="radio" name="K1" value="c"> C. Off-balance sheet derivative notional</label>
          </fieldset>
          <div class="explain" id="exp-K1"><strong>Explanation:</strong> CET1 is the highest quality capital (common equity) that absorbs losses first via dividend cuts and write-downs. When CET1 is thin, banks restrain risk growth; with ample CET1 buffer, there‚Äôs room to expand risk assets.</div>
        </div>
      </article>

      <article class="q card" data-id="K2" data-type="text" data-eval="regex" data-answer="RWA">
        <header><h4>K2: Acronym for risk‚Äëweighted assets</h4><span class="type">Short Text</span></header>
        <div class="body">
          <input type="text" name="K2" aria-label="K2 input" placeholder="Acronym (e.g., RWA)">
          <div class="explain" id="exp-K2"><strong>Explanation:</strong> RWA compresses portfolio risk into one figure using regulatory risk weights. CET1/RWA is the capital adequacy focal ratio.</div>
        </div>
      </article>

      <article class="q card" data-id="K3" data-type="mc" data-answer="c">
        <header><h4>K3: Meaning of CET1/RWA slack</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K3" value="a"> A. Being below the minimum ratio</label>
            <label class="choice"><input type="radio" name="K3" value="b"> B. One‚Äëyear stable funding buffer</label>
            <label class="choice"><input type="radio" name="K3" value="c"> C. Excess above the minimum regulatory ratio</label>
          </fieldset>
          <div class="explain" id="exp-K3"><strong>Explanation:</strong> Slack is how much the actual CET1/RWA exceeds the required minimum. More slack = more headroom to grow risk assets; less slack = prioritizing de‚Äërisking/capital build.</div>
        </div>
      </article>

      <article class="q card" data-id="K4" data-type="text" data-answer="V_C">
        <header><h4>K4: Symbol for credit capacity (headroom)</h4><span class="type">Short Text</span></header>
        <div class="body">
          <input type="text" name="K4" aria-label="K4 input" placeholder="Symbol (e.g., V_C)">
          <div class="explain" id="exp-K4"><strong>Explanation:</strong> V_C summarizes effective headroom for additional lending after constraints and models. In QTC, smaller V_C makes allocation across uses more critical.</div>
        </div>
      </article>

      <article class="q card" data-id="K5" data-type="mc" data-answer="a">
        <header><h4>K5: What credit pressure p_C represents</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K5" value="a"> A. Shadow price/marginal value of relaxing capacity</label>
            <label class="choice"><input type="radio" name="K5" value="b"> B. Nominal policy interest rate</label>
            <label class="choice"><input type="radio" name="K5" value="c"> C. Monetary base</label>
          </fieldset>
          <div class="explain" id="exp-K5"><strong>Explanation:</strong> p_C is the shadow price of credit capacity V_C: how much objective improves per unit of extra headroom. High p_C signals tight capacity.</div>
        </div>
      </article>

      <article class="q card" data-id="K6" data-type="ms" data-answer="a,c">
        <header><h4>K6: Which qualify as HQLA (select all)</h4><span class="type">Multi-Select</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="checkbox" name="K6" value="a"> A. High‚Äërated government bonds</label>
            <label class="choice"><input type="checkbox" name="K6" value="b"> B. Illiquid unlisted startup equity</label>
            <label class="choice"><input type="checkbox" name="K6" value="c"> C. Central bank reserve balances</label>
          </fieldset>
          <div class="explain" id="exp-K6"><strong>Explanation:</strong> HQLA are assets readily monetizable even under stress. Level‚Äë1 assets include top‚Äërated sovereigns and central bank reserves; illiquid private equity does not qualify.</div>
        </div>
      </article>

      <article class="q card" data-id="K7" data-type="mc" data-answer="b">
        <header><h4>K7: Primary purpose of a liquidity buffer</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K7" value="a"> A. Maximize speculative leverage</label>
            <label class="choice"><input type="radio" name="K7" value="b"> B. Absorb stress outflows and stabilize short‚Äëterm liquidity</label>
            <label class="choice"><input type="radio" name="K7" value="c"> C. Fund long‚Äëterm R&amp;D</label>
          </fieldset>
          <div class="explain" id="exp-K7"><strong>Explanation:</strong> The buffer is a near‚Äëcash reservoir to withstand funding stress. Without it, small shocks can trigger fire‚Äësales or rollover failures.</div>
        </div>
      </article>
      <article class="q card" data-id="K8" data-type="mc" data-answer="c">
        <header><h4>K8: LCR measures</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K8" value="a"> A. Net interest margin</label>
            <label class="choice"><input type="radio" name="K8" value="b"> B. Leverage ratio of tier 1 capital</label>
            <label class="choice"><input type="radio" name="K8" value="c"> C. HQLA / projected 30-day net outflows (correct)</label>
          </fieldset>
          <div class="explain" id="exp-K8"><strong>Explanation:</strong> LCR ensures enough high quality liquid assets for 30-day stress.</div>
        </div>
      </article>

      <article class="q card" data-id="K9" data-type="mc" data-answer="a">
        <header><h4>K9: NSFR focus</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K9" value="a"> A. Stable funding over one-year horizon (correct)</label>
            <label class="choice"><input type="radio" name="K9" value="b"> B. Intraday payment system throughput</label>
            <label class="choice"><input type="radio" name="K9" value="c"> C. Equity risk premium measurement</label>
          </fieldset>
          <div class="explain" id="exp-K9"><strong>Explanation:</strong> NSFR prevents excessive maturity mismatch by requiring stable funding sources.</div>
        </div>
      </article>

      <article class="q card" data-id="K10" data-type="text" data-answer="money-in-circulation">
        <header><h4>K10: Phrase describing active monetary stock (type words)</h4><span class="type">Short Text</span></header>
        <div class="body">
          <input type="text" name="K10" aria-label="K10 input" placeholder="Type phrase">
          <div class="explain" id="exp-K10"><strong>Explanation:</strong> Operational money actually circulating (not just base money) is "money-in-circulation".</div>
        </div>
      </article>

      <article class="q card" data-id="K11" data-type="mc" data-answer="b">
        <header><h4>K11: Distinction between stocks & flows</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K11" value="a"> A. Stocks are period changes; flows are snapshots</label>
            <label class="choice"><input type="radio" name="K11" value="b"> B. Stocks are outstanding amounts; flows are changes per period (correct)</label>
            <label class="choice"><input type="radio" name="K11" value="c"> C. Both are identical in definition</label>
          </fieldset>
          <div class="explain" id="exp-K11"><strong>Explanation:</strong> Stocks = existing totals; flows = incremental changes.</div>
        </div>
      </article>

      <article class="q card" data-id="K12" data-type="mc" data-answer="c">
        <header><h4>K12: Margin credit role</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K12" value="a"> A. Funding long-term plant expansion</label>
            <label class="choice"><input type="radio" name="K12" value="b"> B. Securing trade finance letters of credit</label>
            <label class="choice"><input type="radio" name="K12" value="c"> C. Financing securities positions with leverage (correct)</label>
          </fieldset>
          <div class="explain" id="exp-K12"><strong>Explanation:</strong> Margin credit amplifies market exposure by borrowing against positions.</div>
        </div>
      </article>

      <article class="q card" data-id="K13" data-type="mc" data-answer="a">
        <header><h4>K13: Commercial Paper (CP) characteristics</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K13" value="a"> A. Short-term unsecured corporate debt (correct)</label>
            <label class="choice"><input type="radio" name="K13" value="b"> B. Long-term mortgage-backed security</label>
            <label class="choice"><input type="radio" name="K13" value="c"> C. Equity issuance tranche</label>
          </fieldset>
          <div class="explain" id="exp-K13"><strong>Explanation:</strong> CP is issued for short-term funding needs, typically 30‚Äì270 days.</div>
        </div>
      </article>

      <article class="q card" data-id="K14" data-type="mc" data-answer="b">
        <header><h4>K14: Policy work W_policy example</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K14" value="a"> A. Random market fluctuation</label>
            <label class="choice"><input type="radio" name="K14" value="b"> B. Central bank asset purchase program (correct)</label>
            <label class="choice"><input type="radio" name="K14" value="c"> C. User device power state</label>
          </fieldset>
          <div class="explain" id="exp-K14"><strong>Explanation:</strong> Structured interventions (QE, guarantees) represent policy work channels.</div>
        </div>
      </article>

      <article class="q card" data-id="K15" data-type="mc" data-answer="c">
        <header><h4>K15: MECE partition purpose</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K15" value="a"> A. Maximizes entropy automatically</label>
            <label class="choice"><input type="radio" name="K15" value="b"> B. Ensures overlapping categories for redundancy</label>
            <label class="choice"><input type="radio" name="K15" value="c"> C. Avoids overlap and gaps for clean allocation</label>
          </fieldset>
          <div class="explain" id="exp-K15"><strong>Explanation:</strong> MECE ensures allocation shares form a proper probability distribution for entropy S_M.</div>
        </div>
      </article>

      <article class="q card" data-id="K16" data-type="mc" data-answer="b">
        <header><h4>K16: State variable trait</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K16" value="a"> A. Depends on entire historical path</label>
            <label class="choice"><input type="radio" name="K16" value="b"> B. Determined by current state (path-independent)</label>
            <label class="choice"><input type="radio" name="K16" value="c"> C. Must be a physical temperature</label>
          </fieldset>
          <div class="explain" id="exp-K16"><strong>Explanation:</strong> State variables allow Maxwell-like derivative relations; proxies approximate them.</div>
        </div>
      </article>

      <article class="q card" data-id="K17" data-type="mc" data-answer="a">
        <header><h4>K17: Hysteresis indicator</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K17" value="a"> A. Non-zero loop area over a cycle</label>
            <label class="choice"><input type="radio" name="K17" value="b"> B. Perfectly reversible transformation</label>
            <label class="choice"><input type="radio" name="K17" value="c"> C. Constant p_C regardless of changes</label>
          </fieldset>
          <div class="explain" id="exp-K17"><strong>Explanation:</strong> Non-zero loop area signals dissipative or irreversible dynamics in (S_M, V_C) space.</div>
        </div>
      </article>

      <article class="q card" data-id="K18" data-type="ms" data-answer="a,c">
        <header><h4>K18: Early-warning tools include (select all)</h4><span class="type">Multi-Select</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="checkbox" name="K18" value="a"> A. Stress scenario capital depletion analysis</label>
            <label class="choice"><input type="checkbox" name="K18" value="b"> B. Random movie rating collection</label>
            <label class="choice"><input type="checkbox" name="K18" value="c"> C. Liquidity coverage deterioration monitor</label>
          </fieldset>
          <div class="explain" id="exp-K18"><strong>Explanation:</strong> Stress tests and trend monitors form an early-warning suite.</div>
        </div>
      </article>

      <article class="q card" data-id="K19" data-type="mc" data-answer="c">
        <header><h4>K19: Credit-first perspective emphasizes</h4><span class="type">Multiple Choice</span></header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="K19" value="a"> A. Base money as sole driver</label>
            <label class="choice"><input type="radio" name="K19" value="b"> B. Ignoring lending composition</label>
            <label class="choice"><input type="radio" name="K19" value="c"> C. Bank lending creates deposits; allocation matters</label>
          </fieldset>
          <div class="explain" id="exp-K19"><strong>Explanation:</strong> Quantity Theory of Credit tracks credit creation channels and use categories, not just aggregate money stock.</div>
        </div>
      </article>
    </section>

    <div class="card panel" id="bottom-actions">
      <div class="row" style="justify-content:flex-end">
        <button class="btn success" id="bottomShowAnswers" data-results-target="results-bottom">Show Answers & Score</button>
      </div>
      <div class="results card" id="results-bottom" aria-live="polite" style="display:none"></div>
    </div>

    <footer class="muted" style="margin-top:24px">
      <p>This drill helps elevate <strong id="footer-skill">Thermo-Credit Glossary</strong> to ‚Äú<em id="footer-goal">Recall and explain each K# concept with intuition</em>‚Äù.</p>
      <p style="margin:.4rem 0 0"><span id="footer-brand"></span> <span id="copyright"></span></p>
    </footer>
  </div>

  <!-- Reuse core quiz logic from quiz_template (copied minimal subset) -->
  <script>
  (function(){
    const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    const ESCAPE_MAP={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"};
    const escapeHtml=str=>(str??'').replace(/[&<>"']/g,ch=>ESCAPE_MAP[ch]||ch);
    const locale=(document.documentElement.lang||'').toLowerCase();
    const DETAIL_TEXT=locale.startsWith('ja')?
      {
        detailHeading:'Ë©≥Á¥∞„É™„Çπ„Éà',
        detailDescription:'ÂêÑË®≠Âïè„ÅÆÂõûÁ≠î„ÉªÊ≠£Ëß£„Éª„Çπ„Ç≥„Ç¢„ÉªËß£Ë™¨„Çí„Åæ„Å®„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ',
        columns:{question:'Ë®≠Âïè',response:'ÂõûÁ≠î',correct:'Ê≠£Ëß£',score:'„Çπ„Ç≥„Ç¢',explanation:'Ëß£Ë™¨'},
        status:{correct:'Ê≠£Ëß£',incorrect:'‰∏çÊ≠£Ëß£',unanswered:'Êú™ÂõûÁ≠î'},
        noAnswer:'Êú™ÂõûÁ≠î',
        notAvailable:'N/A',
        none:'„Å™„Åó'
      }:
      {
        detailHeading:'Detailed Breakdown',
        detailDescription:'Responses, correct answers, scores, and explanations for each question.',
        columns:{question:'Question',response:'Response',correct:'Correct Answer',score:'Score',explanation:'Explanation'},
        status:{correct:'Correct',incorrect:'Incorrect',unanswered:'Unanswered'},
        noAnswer:'Not answered',
        notAvailable:'N/A',
        none:'None'
      };
    const THEME_KEY='quizTheme'; const prefersDark=window.matchMedia('(prefers-color-scheme: dark)');
    function resolveResultsBox(targetId){
      if(targetId){
        const el=document.getElementById(targetId);
        if(el) return el;
      }
      return document.getElementById('results-bottom') || $('#results') || document.querySelector('.results');
    }
    function updateThemeToggle(mode){const b=$('#themeToggle'); if(!b) return; const L=mode==='light'; b.textContent=L?'üåô Dark':'üåû Light'; b.setAttribute('aria-pressed',L?'true':'false');}
    function setTheme(m,persist=true){const n=m==='light'?'light':'dark'; document.body.setAttribute('data-theme',n); if(persist){try{localStorage.setItem(THEME_KEY,n);}catch(e){}} updateThemeToggle(n);}    
    function applyInitialTheme(){let s=null; try{s=localStorage.getItem(THEME_KEY);}catch(e){} const init=s||(prefersDark.matches?'dark':'light'); setTheme(init,false);}    
    function toggleTheme(){const c=document.body.getAttribute('data-theme')==='light'?'light':'dark'; setTheme(c==='light'?'dark':'light',true);}    
    function applySettings(){const S=window.DRILL_SETTINGS||{}; const name=S.SKILL_NAME; const sub=S.SKILL_SUBTITLE; const goal=S.GOAL_DESCRIPTION; $('#title').textContent=`${name} Drill: ${sub}`; $('#subtitle').textContent=`Practice mapping from K# markers to definitions`; $('#footer-skill').textContent=name; $('#footer-goal').textContent=goal; const img=$('#brand-logo'); if(img&&S.BRAND_LOGO){img.src=S.BRAND_LOGO; img.style.display='inline-block'; img.alt=S.BRAND_NAME;} $('#brand-name').textContent=S.BRAND_NAME; $('#brand-link').href=S.BRAND_URL; $('#footer-brand').innerHTML=`<strong>${S.BRAND_NAME}</strong>`;}    
  function updateModeBadge(){const on=$('#learningMode')?.checked; const mb=$('#mode-badge'); if(!mb) return; mb.textContent=on?'Learning Mode':'Test Mode'; mb.setAttribute('aria-pressed',on?'true':'false'); renderLearningMarkers();}
  function renderLearningMarkers(){const on=$('#learningMode')?.checked; $$('#questions .q').forEach(q=>{const type=q.dataset.type; const ans=(q.dataset.answer||'').trim(); let gold=[]; if(type==='mc'){gold=[ans];} else if(type==='ms'){gold=ans.split(',').map(s=>s.trim());} q.querySelectorAll('.choices label.choice').forEach(l=>{const input=l.querySelector('input'); if(!input) return; const v=input.value; let m=l.querySelector('.correct-marker'); if(on && gold.includes(v)){ if(!m){ m=document.createElement('span'); m.className='correct-marker'; m.style.marginLeft='6px'; m.style.fontSize='11px'; m.style.color='var(--accent,#5aa7ff)'; m.textContent='‚úì'; l.appendChild(m);} } else { if(m) m.remove(); } }); }); }
    function showExplain(q,show=true){const exp=q.querySelector('.explain'); if(!exp) return; exp.classList.toggle('show',!!show);}    
    function evaluateQuestion(q){const id=q.dataset.id; const type=q.dataset.type; const ans=(q.dataset.answer||'').trim(); let ok=null,user=null; if(type==='mc'){const p=q.querySelector('input[type=radio]:checked'); if(!p){ok=null;} else {user=p.value; ok=(user===ans);} } else if(type==='ms'){const picked=q.querySelectorAll('input[type=checkbox]:checked'); user=Array.from(picked).map(i=>i.value).sort(); if(!user.length){ok=null;} else {const gold=ans.split(',').map(s=>s.trim()).sort(); ok=JSON.stringify(user)===JSON.stringify(gold);} } else if(type==='text'){const t=q.querySelector('input[type=text]'); user=(t?.value||'').trim(); const mode=(q.dataset.eval||'exact').toLowerCase(); if(!user){ok=null;} else if(mode==='regex'){try{const re=new RegExp(ans,'i'); ok=re.test(user);}catch(e){ok=false;}} else {ok=(user===ans);} } const exp=q.querySelector('.explain'); const explainHtml=exp?exp.innerHTML.trim():''; return {id,type,ok,user,explainHtml};}
    function isAnswered(q){const t=q.dataset.type; if(t==='mc') return !!q.querySelector('input[type=radio]:checked'); if(t==='ms') return q.querySelectorAll('input[type=checkbox]:checked').length>0; if(t==='text'){const v=q.querySelector('input[type=text]')?.value.trim(); return !!v;} return false;}
    function computeLiveScore(){const qs=$$('#questions .q'); let total=0,correct=0,answered=0; qs.forEach(q=>{total++; const r=evaluateQuestion(q); if(r.ok===true) correct++; if(isAnswered(q)) answered++;}); return {total,correct,answered};}
    function updateLiveScore(){const s=computeLiveScore(); const el=$('#score-badge'); if(el){el.textContent=s.correct+' / '+s.total; el.title='Correct '+s.correct+' of '+s.total;}}
    function renderResults(targetId){let total=0,correct=0,answered=0; const rows=[]; $$('#questions .q').forEach(q=>{total++; const r=evaluateQuestion(q); if(isAnswered(q)) answered++; if(r.ok===true) correct++; const st=scoreLabel(r.ok); const exp=r.explainHtml||''; const title=q.querySelector('h4')?.textContent.trim()||r.id; const userDisp=escapeHtml(stringifyAnswerValue(r.user)); const correctDisp=escapeHtml(formatCorrectAnswerDisplay(q)); rows.push('<tr>'+
        '<td><div><strong>'+escapeHtml(r.id)+'</strong></div><div>'+escapeHtml(title)+'</div></td>'+
        '<td>'+userDisp+'</td>'+
        '<td>'+correctDisp+'</td>'+
        '<td>'+escapeHtml(st)+'</td>'+
        '<td>'+(exp||'')+'</td>'+
      '</tr>');}); const table='<div class="table-wrapper"><table><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Status</th><th>Explanation</th></tr></thead><tbody>'+rows.join('')+'</tbody></table></div>'; const box=resolveResultsBox(targetId); if(!box) return; box.innerHTML='<h4 style="margin:0 0 8px">Score</h4><p>Correct: <strong>'+correct+'</strong> / '+total+' (answered: '+answered+')</p>'+table; box.style.display='block';}
    function stringifyAnswerValue(value){ if(Array.isArray(value)) return value.join(', '); if(value===undefined||value===null) return ''; return value.toString ? value.toString() : String(value); }
    function cleanLabelText(text){ return (text||'').replace(/\s+/g,' ').trim(); }
    function findChoiceLabel(q,value){
      const inputs=q.querySelectorAll('input[type=radio],input[type=checkbox]');
      for(const input of inputs){
        if(input.value===value){
          const label=input.closest('label');
          return label?cleanLabelText(label.textContent):value;
        }
      }
      return value;
    }
    function describeChoiceList(q,values){
      if(!values || !values.length) return '';
      return values.map(val=>findChoiceLabel(q,val)).join(', ');
    }
    function formatUserAnswerDisplay(q,evaluation){
      const type=q.dataset.type;
      if(type==='mc'){
        return evaluation.user ? findChoiceLabel(q,evaluation.user) : '';
      }
      if(type==='ms'){
        const vals=Array.isArray(evaluation.user)?evaluation.user:[];
        return vals.length ? describeChoiceList(q,vals) : '';
      }
      if(type==='text'){
        return evaluation.user || '';
      }
      return stringifyAnswerValue(evaluation.user);
    }
    function formatCorrectAnswerDisplay(q){
      const type=q.dataset.type;
      const ans=(q.dataset.answer||'').trim();
      if(!ans) return '';
      if(type==='mc') return findChoiceLabel(q,ans);
      if(type==='ms'){
        const vals=ans.split(',').map(s=>s.trim()).filter(Boolean);
        return vals.length?describeChoiceList(q,vals):'';
      }
      if(type==='text'){
        const mode=(q.dataset.eval||'exact').toLowerCase();
        return mode==='regex' ? 'Regex: '+ans : ans;
      }
      return ans;
    }
    function buildQuestionDetail(q,evaluation){
      return {
        id:evaluation.id,
        title:q.querySelector('h4')?.textContent.trim()||evaluation.id,
        userDisplay:formatUserAnswerDisplay(q,evaluation),
        correctDisplay:formatCorrectAnswerDisplay(q),
        explanationHTML:q.querySelector('.explain')?.innerHTML.trim()||'',
        ok:evaluation.ok
      };
    }
    function scoreLabel(ok){
      if(ok===true) return DETAIL_TEXT.status.correct;
      if(ok===false) return DETAIL_TEXT.status.incorrect;
      return DETAIL_TEXT.status.unanswered;
    }
    function ensureBottomDetailBox(){
      let box=document.getElementById('results-bottom-detail');
      if(!box){
        box=document.createElement('div');
        box.className='results card';
        box.id='results-bottom-detail';
        box.setAttribute('aria-live','polite');
        const panel=document.getElementById('bottom-actions');
        (panel||document.body).appendChild(box);
      }
      return box;
    }
    function renderBottomDetail(details){
      if(!details || !details.length) return;
      const box=ensureBottomDetailBox();
      if(!box) return;
      const rows=details.map(item=>
        '<tr>'+
          '<td><div><strong>'+escapeHtml(item.id)+'</strong></div><div>'+escapeHtml(item.title)+'</div></td>'+
          '<td>'+escapeHtml(item.userDisplay || DETAIL_TEXT.noAnswer)+'</td>'+
          '<td>'+escapeHtml(item.correctDisplay || DETAIL_TEXT.notAvailable)+'</td>'+
          '<td>'+escapeHtml(scoreLabel(item.ok))+'</td>'+
          '<td>'+(item.explanationHTML || '')+'</td>'+
        '</tr>'
      ).join('');
      box.innerHTML=
        '<h4 style="margin:0 0 8px">'+DETAIL_TEXT.detailHeading+'</h4>'+
        '<div class="table-wrapper">'+
          '<table><thead><tr>'+
            '<th>'+DETAIL_TEXT.columns.question+'</th>'+
            '<th>'+DETAIL_TEXT.columns.response+'</th>'+
            '<th>'+DETAIL_TEXT.columns.correct+'</th>'+
            '<th>'+DETAIL_TEXT.columns.score+'</th>'+
            '<th>'+DETAIL_TEXT.columns.explanation+'</th>'+
          '</tr></thead><tbody>'+rows+'</tbody></table>'+
        '</div>';
      box.style.display='block';
    }
    function showAnswersAndScore(targetId){
      let total=0,correct=0,answered=0;
      const rows=[];
      const questionDetails=[];
      $$('#questions .q').forEach(q=>{
        total++;
        const result=evaluateQuestion(q);
        if(isAnswered(q)) answered++;
        if(result.ok===true) correct++;
        const gold=(q.dataset.answer||'').split(',').map(s=>s.trim()).filter(Boolean);
        if(q.dataset.type==='mc' || q.dataset.type==='ms'){
          q.querySelectorAll('.choice').forEach(lbl=>{
            const val=lbl.querySelector('input')?.value;
            if(!val) return;
            if(gold.includes(val)) lbl.classList.add('correct');
          });
        } else if(q.dataset.type==='text'){
          const exp=q.querySelector('.explain');
          if(exp && !exp.dataset.hinted){
            const hint=document.createElement('div');
            hint.className='muted';
            hint.innerHTML='<strong>Answer hint:</strong> '+escapeHtml(q.dataset.answer||'');
            exp.appendChild(hint);
            exp.dataset.hinted='1';
          }
        }
        showExplain(q,true);
        const qTitle=q.querySelector('h4')?.textContent.trim()||q.dataset.id;
        const expHtml=q.querySelector('.explain')?.innerHTML.trim()||'';
        const status=scoreLabel(result.ok);
        const correctDisp=formatCorrectAnswerDisplay(q);
        rows.push('<tr>'+
          '<td><div><strong>'+escapeHtml(result.id)+'</strong></div><div>'+escapeHtml(qTitle)+'</div></td>'+
          '<td>'+escapeHtml(stringifyAnswerValue(result.user))+'</td>'+
          '<td>'+escapeHtml(correctDisp)+'</td>'+
          '<td>'+escapeHtml(status)+'</td>'+
          '<td>'+(expHtml||'')+'</td>'+
        '</tr>');
        questionDetails.push(buildQuestionDetail(q,result));
      });
      const box=resolveResultsBox(targetId);
      if(box){
        const scoreHeading=locale.startsWith('ja')?'„Çπ„Ç≥„Ç¢':'Score';
        const summaryLabel=locale.startsWith('ja')
          ? 'Ê≠£Ëß£: <strong>'+correct+'</strong> / '+total+' (ÂõûÁ≠î: '+answered+')'
          : 'Correct: <strong>'+correct+'</strong> / '+total+' (answered: '+answered+')';
        const tableHeaderQuestion=DETAIL_TEXT.columns.question;
        const tableHeaderResponse=DETAIL_TEXT.columns.response;
        const tableHeaderCorrect=DETAIL_TEXT.columns.correct;
        const tableHeaderScore=DETAIL_TEXT.columns.score;
        const tableHeaderExplanation=DETAIL_TEXT.columns.explanation;
        const table='<table><thead><tr><th>'+tableHeaderQuestion+'</th><th>'+tableHeaderResponse+'</th><th>'+tableHeaderCorrect+'</th><th>'+tableHeaderScore+'</th><th>'+tableHeaderExplanation+'</th></tr></thead><tbody>'+rows.join('')+'</tbody></table>';
        box.innerHTML='<h4 style="margin:0 0 8px">'+scoreHeading+'</h4><p>'+summaryLabel+'</p>'+table;
        box.style.display='block';
      }
      return {total,correct,answered,questionDetails};
    }
    $('#themeToggle')?.addEventListener('click',()=>{toggleTheme(); updateLiveScore();});
  $('#mode-badge').addEventListener('click',()=>{let lm=$('#learningMode'); if(!lm){ lm=document.createElement('input'); lm.type='checkbox'; lm.id='learningMode'; lm.checked=true; lm.style.display='none'; document.body.appendChild(lm);} lm.checked=!lm.checked; updateModeBadge();});
    const bottomShowBtn = $('#bottomShowAnswers');
    if(bottomShowBtn){
      bottomShowBtn.addEventListener('click',()=>{
        showAnswersAndScore(bottomShowBtn.dataset.resultsTarget);
      });
    }
    $$('#questions .q').forEach(q=>{const t=q.dataset.type; if(t==='mc'){q.querySelectorAll('input[type=radio]').forEach(r=>r.addEventListener('change',()=>{evaluateQuestion(q); if($('#learningMode')?.checked){showExplain(q,true);} updateLiveScore();}));} else if(t==='ms'){q.querySelectorAll('input[type=checkbox]').forEach(r=>r.addEventListener('change',()=>{evaluateQuestion(q); if($('#learningMode')?.checked){showExplain(q,true);} updateLiveScore();}));} else if(t==='text'){const i=q.querySelector('input[type=text]'); i?.addEventListener('input',()=>{evaluateQuestion(q); if($('#learningMode')?.checked && i.value.trim().length){showExplain(q,true);} updateLiveScore();});}});
    applyInitialTheme(); prefersDark.addEventListener?.('change',e=>{let s=null; try{s=localStorage.getItem(THEME_KEY);}catch(_){s=null;} if(s) return; setTheme(e.matches?'dark':'light',false);}); applySettings(); if(!$('#learningMode')){const lm=document.createElement('input'); lm.type='checkbox'; lm.id='learningMode'; lm.checked=true; lm.style.display='none'; document.body.appendChild(lm);} updateModeBadge(); updateLiveScore();
  })();
  </script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[SKILL_NAME] 101: [SKILL_SUBTITLE]ï¼ˆå­¦ç¿’ãƒ‰ãƒªãƒ«ï¼‰</title>
  <!-- NOTE: ç›¸å¯¾ãƒ‘ã‚¹ã§OKï¼ˆåŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« EN/JA ã‚’ä½œã‚‹æƒ³å®šï¼‰ -->
  <link rel="alternate" hreflang="ja" href="quiz_template.html" />
  <link rel="alternate" hreflang="en" href="quiz_template_en.html" />
  <link rel="stylesheet" href="quiz.css" />
  <!-- Styles moved to external stylesheet: quiz.css -->
</head>
<body data-theme="dark">
  <!-- ====== SETTINGS (ç·¨é›†) =============================================== -->
  <script>
    window.DRILL_SETTINGS = {
      SKILL_NAME: "[REPLACE_SKILL]",
      SKILL_SUBTITLE: "[REPLACE_SUBTITLE]",
      GOAL_DESCRIPTION: "[REPLACE_GOAL]",
      LEARNING_MODE_DEFAULT: true
    };
  </script>
  <!-- ====================================================================== -->

  <div class="container">
    <header>
      <div>
        <div class="brand">
          <a id="brand-link" href="#" aria-label="brand">
            <img id="brand-logo" alt="brand logo" src="" width="40" height="40" style="display:none">
            <span id="brand-name" class="name">[BRAND]</span>
          </a>
        </div>
        <h1 id="title">[SKILL_NAME] 101: [SKILL_SUBTITLE]ï¼ˆå­¦ç¿’ãƒ‰ãƒªãƒ«ï¼‰</h1>
        <h2 id="subtitle">[SKILL_NAME] ã‚’ã€Œ[GOAL_DESCRIPTION]ã€ã¾ã§å¼•ãä¸Šã’ã‚‹ãŸã‚ã®ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ãƒ‰ãƒªãƒ«</h2>
      </div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <button type="button" class="theme-toggle" id="themeToggle" aria-pressed="false">ğŸŒ ãƒ©ã‚¤ãƒˆ</button>
        <div class="lang-toggle" aria-label="Language switcher">
          <a href="quiz_template.html" class="active" aria-current="page">æ—¥æœ¬èª</a>
          <a href="quiz_template_en.html">English</a>
        </div>
        <button type="button" class="badge clickable" id="mode-badge" aria-live="polite" aria-pressed="true" title="ã‚¯ãƒªãƒƒã‚¯ã§å­¦ç¿’/ãƒ†ã‚¹ãƒˆåˆ‡æ›¿">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</button>
        <span id="score-badge" aria-live="polite" title="ãƒ©ã‚¤ãƒ–ã‚¹ã‚³ã‚¢">0 / 0</span>
      </div>
    </header>

    <section class="card scope" aria-labelledby="scope-h">
      <h3 id="scope-h">ãƒ†ã‚¹ãƒˆã®ç¯„å›²</h3>
      <ul>
        <li><strong>æƒ³å®šãƒ¬ãƒ™ãƒ«</strong>: åˆå¿ƒè€…ã§ã‚‚åˆ°é”å¯èƒ½ãªèª­è§£ãƒ‰ãƒªãƒ«ã€‚</li>
        <li><strong>åˆ°é”ç›®æ¨™</strong>: ä¸»è¦ç”¨èªã®å®šç¾©ã‚’ç¤ºã—ã€èƒŒæ™¯ã‚„ç›´æ„Ÿã‚‚å«ã‚ã¦è‡ªåˆ†ã®è¨€è‘‰ã§èª¬æ˜ã§ãã‚‹ã€‚</li>
      </ul>
    </section>

    <section class="card panel" aria-labelledby="ops-h">
      <h3 id="ops-h">æ“ä½œãƒ‘ãƒãƒ«</h3>
      <div class="row">
        <label class="switch" for="learningMode">
          <input id="learningMode" type="checkbox" checked>
          <span class="ui-toggle" aria-hidden="true"></span>
          <span class="switch-label">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼ˆé¸æŠ/å…¥åŠ›ã—ãŸè¨­å•ã®è§£èª¬ã‚’å³è¡¨ç¤ºï¼‰</span>
        </label>
      </div>
      <div class="row">
        <button class="btn ghost" id="showAll">è§£èª¬ å…¨è¡¨ç¤º</button>
        <button class="btn ghost" id="hideAll">è§£èª¬ å…¨éè¡¨ç¤º</button>
        <button class="btn primary" id="regen">çµæœãƒ†ãƒ¼ãƒ–ãƒ«å†ç”Ÿæˆ</button>
        <button class="btn success" id="showAnswersScore">è§£ç­”ã¨ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º</button>
      </div>
      <div class="results card" id="results" aria-live="polite" style="display:none"></div>
    </section>

    <details class="cheatsheet card">
      <summary>Cheat Sheet: æœ€å°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆä»»æ„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰</summary>
      <div class="sheet">
        <!-- ã“ã“ã«å‚è€ƒãƒ¡ãƒ¢ã‚’å…¥ã‚Œã‚‹ï¼ˆä»»æ„ï¼‰ -->
        <ul>
          <li>ç”¨èªA: å®šç¾© â€¦</li>
          <li>ç”¨èªB: å®šç¾© â€¦</li>
        </ul>
      </div>
    </details>

    <!-- ================== QUESTIONS ======================================= -->
    <section id="questions">
      <!-- Sample MC -->
      <article class="q card" data-id="Q1" data-type="mc" data-answer="b">
        <header>
          <h4>Q1: ã‚µãƒ³ãƒ—ãƒ«ã®è¨­å•ï¼ˆå˜ä¸€é¸æŠï¼‰</h4>
          <span class="type">Type: Multiple Choice</span>
        </header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="radio" name="Q1" value="a"> A. é¸æŠè‚¢A</label>
            <label class="choice"><input type="radio" name="Q1" value="b"> B. é¸æŠè‚¢Bï¼ˆæ­£è§£ï¼‰</label>
            <label class="choice"><input type="radio" name="Q1" value="c"> C. é¸æŠè‚¢C</label>
          </fieldset>
          <div class="explain" id="exp-Q1"><strong>è§£èª¬:</strong> ã“ã“ã«è§£èª¬ã‚’è¨˜è¼‰ã€‚</div>
        </div>
      </article>

      <!-- Sample MS -->
      <article class="q card" data-id="Q2" data-type="ms" data-answer="a,c">
        <header>
          <h4>Q2: ã‚µãƒ³ãƒ—ãƒ«ã®è¨­å•ï¼ˆè¤‡æ•°é¸æŠï¼‰</h4>
          <span class="type">Type: Multi-Select</span>
        </header>
        <div class="body">
          <fieldset class="choices">
            <label class="choice"><input type="checkbox" name="Q2" value="a"> A. é¸æŠè‚¢Aï¼ˆæ­£è§£ï¼‰</label>
            <label class="choice"><input type="checkbox" name="Q2" value="b"> B. é¸æŠè‚¢B</label>
            <label class="choice"><input type="checkbox" name="Q2" value="c"> C. é¸æŠè‚¢Cï¼ˆæ­£è§£ï¼‰</label>
          </fieldset>
          <div class="explain" id="exp-Q2"><strong>è§£èª¬:</strong> ã“ã“ã«è§£èª¬ã‚’è¨˜è¼‰ã€‚</div>
        </div>
      </article>

      <!-- Sample TEXT (regex) -->
      <article class="q card" data-id="Q3" data-type="text" data-eval="regex" data-answer="^ABC$">
        <header>
          <h4>Q3: ã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› / æ­£è¦è¡¨ç¾ï¼‰</h4>
          <span class="type">Type: Short Text</span>
        </header>
        <div class="body">
          <input type="text" inputmode="text" autocomplete="off" name="Q3" aria-label="Q3 å…¥åŠ›" placeholder="ã“ã“ã«å…¥åŠ›">
          <div class="explain" id="exp-Q3"><strong>è§£èª¬:</strong> å…¥åŠ›ãŒæ­£è¦è¡¨ç¾ ^ABC$ ã«ä¸€è‡´ã™ã‚‹ã¨æ­£è§£ã€‚</div>
        </div>
      </article>

      <!-- Sample Classify (DnD) -->
      <article class="q card" data-id="Q4" data-type="classify" data-answer="group1:a,c;group2:b,d">
        <header>
          <h4>Q4: ã‚µãƒ³ãƒ—ãƒ«ï¼ˆåˆ†é¡: ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰</h4>
          <span class="type">Type: Classify (DnD)</span>
        </header>
        <div class="body">
          <div class="dd-wrap">
            <div class="bucket" data-group="group1"><h5>ã‚°ãƒ«ãƒ¼ãƒ—1</h5></div>
            <div class="bucket" data-group="group2"><h5>ã‚°ãƒ«ãƒ¼ãƒ—2</h5></div>
          </div>
          <div class="bucket pool" data-group="pool">
            <span class="chip" draggable="true" data-value="a">A</span>
            <span class="chip" draggable="true" data-value="b">B</span>
            <span class="chip" draggable="true" data-value="c">C</span>
            <span class="chip" draggable="true" data-value="d">D</span>
          </div>
          <div class="explain" id="exp-Q4"><strong>è§£èª¬:</strong> æ­£ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã¸åˆ†é¡ã€‚</div>
        </div>
      </article>

      <!-- Sample Segment (Chart) -->
      <article class="q card" data-id="Q5" data-type="segment" data-answer="2">
        <header>
          <h4>Q5: ã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒãƒ£ãƒ¼ãƒˆã®æœŸé–“é¸æŠï¼‰</h4>
          <span class="type">Type: Chart segment</span>
        </header>
        <div class="body">
          <div class="mini-chart" style="height:180px">
            <canvas id="miniChart" width="560" height="110" style="width:100%;height:110px"></canvas>
            <div class="segments" role="group" aria-label="æœŸé–“é¸æŠ">
              <button type="button" class="segment" data-idx="1">æœŸé–“A</button>
              <button type="button" class="segment" data-idx="2">æœŸé–“B</button>
              <button type="button" class="segment" data-idx="3">æœŸé–“C</button>
            </div>
          </div>
          <div class="explain" id="exp-Q5"><strong>è§£èª¬:</strong> æœ€ã‚‚æ¡ä»¶ã«åˆã†æœŸé–“ã‚’é¸æŠã€‚</div>
        </div>
      </article>
    </section>

    <div class="card panel" id="bottom-actions">
      <div class="row" style="justify-content:flex-end">
        <button class="btn success" id="bottomShowAnswers">è§£ç­”ã¨ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º</button>
      </div>
    </div>

    <footer class="muted" style="margin-top:24px">
      <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ <strong id="footer-skill">[SKILL_NAME]</strong> ã‚’ â€œ<em id="footer-goal">[GOAL_DESCRIPTION]</em>â€ ãƒ¬ãƒ™ãƒ«ã¸å°ããŸã‚ã® <em>LEARNING FIRST</em> ãƒ‰ãƒªãƒ«ã§ã™ã€‚</p>
      <p style="margin:.4rem 0 0"><span id="footer-brand"></span> <span id="copyright"></span></p>
    </footer>
  </div>

  <script>
  (function(){
    const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    const THEME_KEY='quizTheme'; const prefersDark=window.matchMedia('(prefers-color-scheme: dark)');

    function updateThemeToggle(mode){const b=$('#themeToggle'); if(!b) return; const L=mode==='light'; b.textContent=L?'ğŸŒ™ ãƒ€ãƒ¼ã‚¯':'ğŸŒ ãƒ©ã‚¤ãƒˆ'; b.setAttribute('aria-pressed',L?'true':'false');}
    function setTheme(m,persist=true){const n=m==='light'?'light':'dark'; document.body.setAttribute('data-theme',n); if(persist){try{localStorage.setItem(THEME_KEY,n);}catch(e){}} updateThemeToggle(n);}    
    function applyInitialTheme(){let s=null; try{s=localStorage.getItem(THEME_KEY);}catch(e){} const init=s||(prefersDark.matches?'dark':'light'); setTheme(init,false);}    
    function toggleTheme(){const c=document.body.getAttribute('data-theme')==='light'?'light':'dark'; setTheme(c==='light'?'dark':'light',true);}    

    function applySettings(){
      const S=window.DRILL_SETTINGS||{};
      const name=S.SKILL_NAME||'[SKILL_NAME]';
      const sub=S.SKILL_SUBTITLE||'[SKILL_SUBTITLE]';
      const goal=S.GOAL_DESCRIPTION||'[GOAL_DESCRIPTION]';
      document.title=`${name} 101: ${sub}ï¼ˆå­¦ç¿’ãƒ‰ãƒªãƒ«ï¼‰`;
      $('#title').textContent=`${name} 101: ${sub}ï¼ˆå­¦ç¿’ãƒ‰ãƒªãƒ«ï¼‰`;
      $('#subtitle').textContent=`${name} ã‚’ã€Œ${goal}ã€ã¾ã§å¼•ãä¸Šã’ã‚‹ãŸã‚ã®ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ãƒ‰ãƒªãƒ«`;
      $('#footer-skill').textContent=name; $('#footer-goal').textContent=goal;
      // Brand
      const bName = S.BRAND_NAME || '[BRAND]';
      const bLogo = S.BRAND_LOGO || 'og-brand-clean.min.png';
      const bUrl  = S.BRAND_URL  || '#';
      $('#brand-name').textContent = bName;
      $('#brand-link').setAttribute('href', bUrl);
      const img = $('#brand-logo');
      if(bLogo){ img.src = bLogo; img.style.display='inline-block'; img.alt = bName; }
      $('#footer-brand').innerHTML = `<strong>${bName}</strong>` + (bUrl && bUrl!=='#' ? ` â€“ <a href="${bUrl}">${bUrl}</a>` : '');
      // Copyright
      const year = new Date().getFullYear();
      $('#copyright').textContent = `Â© ${year} ${bName}. All rights reserved.`;
      // Learning mode default
      $('#learningMode').checked=S.LEARNING_MODE_DEFAULT!==false; updateModeBadge();
    }
    function updateModeBadge(){const on=$('#learningMode').checked; const mb=$('#mode-badge'); if(!mb) return; mb.textContent=on?'å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰':'ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰'; mb.setAttribute('aria-pressed',on?'true':'false'); mb.setAttribute('title',on?'ã‚¯ãƒªãƒƒã‚¯ã§ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã¸':'ã‚¯ãƒªãƒƒã‚¯ã§å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã¸');}

    function showExplain(q,show=true){const exp=q.querySelector('.explain'); if(!exp) return; exp.classList.toggle('show',!!show); const btn=q.querySelector('.answer-btn'); if(btn){btn.textContent=exp.classList.contains('show')?'è§£èª¬ã‚’éš ã™':'è§£ç­”ã‚’è¡¨ç¤º';}}
    function markChoices(q,userValues,goldValues){q.querySelectorAll('.choice').forEach(l=>{l.classList.remove('correct','wrong'); const v=l.querySelector('input')?.value; if(!v) return; if(userValues?.includes(v)){l.classList.add(goldValues.includes(v)?'correct':'wrong');}});}    
    function evaluateQuestion(q){const id=q.dataset.id; const type=q.dataset.type; const ans=(q.dataset.answer||'').trim(); let ok=null,user=null; if(type==='mc'){const p=q.querySelector('input[type=radio]:checked'); if(!p){ok=null;} else {user=p.value; ok=(user===ans); markChoices(q,[user],ans.split(','));}} else if(type==='ms'){const picked=q.querySelectorAll('input[type=checkbox]:checked'); user=Array.from(picked).map(i=>i.value).sort(); const gold=ans.split(',').map(s=>s.trim()).sort(); ok=JSON.stringify(user)===JSON.stringify(gold); markChoices(q,user,gold);} else if(type==='text'){const t=q.querySelector('input[type=text]'); user=(t?.value||'').trim(); const mode=(q.dataset.eval||'exact').toLowerCase(); if(mode==='regex'){try{const re=new RegExp(ans,'i'); ok=re.test(user);}catch(e){ok=false;}} else {ok=(user===ans);} } else if(type==='classify'){const parse=s=>Object.fromEntries(s.split(';').map(p=>{const [g,l]=p.split(':'); return [g.trim(), (l?l.split(',').map(x=>x.trim()).filter(Boolean):[])];})); const goldMap=parse(ans); const groups=Object.keys(goldMap); const userMap={}; groups.forEach(g=>{const box=q.querySelector('.bucket[data-group="'+g+'"]'); const vals=Array.from(box?.querySelectorAll('.chip')||[]).map(c=>c.dataset.value).filter(Boolean).sort(); userMap[g]=vals;}); const eq=(a,b)=>JSON.stringify((a||[]).slice().sort())===JSON.stringify((b||[]).slice().sort()); ok=groups.every(g=>eq(userMap[g],goldMap[g])); user=groups.map(g=>g+':'+(userMap[g]||[]).join(',')).join(' | ');} else if(type==='segment'){const picked=q.dataset.segmentSelected||''; user=picked; ok=picked? (picked===ans):null;} return {id,ok,user,type};}

    function isAnswered(q){const t=q.dataset.type; if(t==='mc') return !!q.querySelector('input[type=radio]:checked'); if(t==='ms') return q.querySelectorAll('input[type=checkbox]:checked').length>0; if(t==='text'){const v=q.querySelector('input[type=text]')?.value.trim(); return !!v;} if(t==='classify'){const a=q.querySelectorAll('.bucket:not([data-group="pool"]) .chip').length; return a>0;} if(t==='segment'){return !!q.dataset.segmentSelected;} return false;}

    function computeLiveScore(){const qs=$$('#questions .q'); let total=0,answered=0,correct=0; const eq=(a,b)=>JSON.stringify((a||[]).slice().sort())===JSON.stringify((b||[]).slice().sort()); qs.forEach(q=>{total++; const type=q.dataset.type; const ans=(q.dataset.answer||'').trim(); let ok=null; if(type==='mc'){const p=q.querySelector('input[type=radio]:checked')?.value; if(p){answered++; ok=(p===ans);} } else if(type==='ms'){const picked=Array.from(q.querySelectorAll('input[type=checkbox]:checked')).map(i=>i.value); if(picked.length){answered++; ok=eq(picked, ans.split(',').map(s=>s.trim()));}} else if(type==='text'){const v=q.querySelector('input[type=text]')?.value.trim(); if(v){answered++; const mode=(q.dataset.eval||'exact').toLowerCase(); ok=(mode==='regex')?(()=>{try{return new RegExp(ans,'i').test(v);}catch(e){return false;}})():(v===ans);} } else if(type==='classify'){const parse=s=>Object.fromEntries(s.split(';').map(p=>{const [g,l]=p.split(':'); return [g.trim(), (l?l.split(',').map(x=>x.trim()).filter(Boolean):[])];})); const gold=parse(ans); const groups=Object.keys(gold); let any=false; const all=groups.every(g=>{const vals=Array.from(q.querySelector('.bucket[data-group="'+g+'"]')?.querySelectorAll('.chip')||[]).map(c=>c.dataset.value); if(vals.length) any=true; return eq(vals,gold[g]);}); if(any){answered++; ok=all;} } else if(type==='segment'){const p=q.dataset.segmentSelected; if(p){answered++; ok=(p===ans);} } if(ok===true) correct++;}); return {total,answered,correct};}
    function updateLiveScore(){const s=computeLiveScore(); const el=$('#score-badge'); if(el){el.textContent=s.correct+' / '+s.total; el.title='å›ç­”æ¸ˆã¿ '+s.answered+' / '+s.total;}}

    function renderResults(){const rows=[]; $$('#questions .q').forEach(q=>{const r=evaluateQuestion(q); const st=r.ok===null?'æœªå›ç­”':(r.ok?'æ­£è§£':'ä¸æ­£è§£'); rows.push('<tr><td>'+r.id+'</td><td>'+r.type+'</td><td>'+ (r.user??'') +'</td><td>'+st+'</td></tr>');}); const html='<h4 style="margin:0 0 8px">é›†è¨ˆï¼ˆå­¦ç¿’ç”¨ï¼‰</h4><table><thead><tr><th>Q ID</th><th>Type</th><th>Answer</th><th>Result</th></tr></thead><tbody>'+rows.join('')+'</tbody></table>'; const box=$('#results'); box.innerHTML=html; box.style.display='block';}

    // Handlers
    $('#themeToggle')?.addEventListener('click',()=>{toggleTheme(); updateLiveScore();});
    $('#learningMode').addEventListener('change',()=>{updateModeBadge(); if(!$('#learningMode').checked){$$('.explain').forEach(e=>e.classList.remove('show'));} updateLiveScore();});
    $('#mode-badge').addEventListener('click',()=>{$('#learningMode').checked=!$('#learningMode').checked; $('#learningMode').dispatchEvent(new Event('change'));});
    $('#showAll').addEventListener('click',()=>{$$('.explain').forEach(e=>e.classList.add('show')); updateLiveScore();});
    $('#hideAll').addEventListener('click',()=>{$$('.explain').forEach(e=>e.classList.remove('show')); updateLiveScore();});
    $('#regen').addEventListener('click',renderResults);
    $('#showAnswersScore').addEventListener('click',renderResults);
    $('#bottomShowAnswers').addEventListener('click',()=>{renderResults(); const dd=document.querySelector('details.cheatsheet'); if(dd){ dd.open=true; dd.scrollIntoView({behavior:'smooth',block:'nearest'});} });

    // Per-question behavior
    $$('#questions .q').forEach(q=>{
      const t=q.dataset.type;
      if(t==='mc'){q.querySelectorAll('input[type=radio]').forEach(r=>r.addEventListener('change',()=>{evaluateQuestion(q); if($('#learningMode').checked){showExplain(q,true);} updateLiveScore();}));}
      else if(t==='ms'){q.querySelectorAll('input[type=checkbox]').forEach(r=>r.addEventListener('change',()=>{evaluateQuestion(q); if($('#learningMode').checked){showExplain(q,true);} updateLiveScore();}));}
      else if(t==='text'){const i=q.querySelector('input[type=text]'); i?.addEventListener('input',()=>{evaluateQuestion(q); if($('#learningMode').checked && i.value.trim().length){showExplain(q,true);} updateLiveScore();});}
      else if(t==='classify'){const chips=q.querySelectorAll('.chip'); chips.forEach(ch=>ch.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', ch.dataset.value||''); q._dragEl=ch; })); q.querySelectorAll('.bucket').forEach(b=>{b.addEventListener('dragover',e=>{e.preventDefault(); b.classList.add('hover');}); b.addEventListener('dragleave',()=>b.classList.remove('hover')); b.addEventListener('drop',e=>{e.preventDefault(); b.classList.remove('hover'); if(q._dragEl){ b.appendChild(q._dragEl); evaluateQuestion(q); if($('#learningMode').checked){showExplain(q,true);} updateLiveScore(); }});});}
      else if(t==='segment'){q.querySelectorAll('.segment').forEach(btn=>btn.addEventListener('click',()=>{q.querySelectorAll('.segment').forEach(x=>x.classList.remove('selected')); btn.classList.add('selected'); q.dataset.segmentSelected=btn.dataset.idx; evaluateQuestion(q); if($('#learningMode').checked){showExplain(q,true);} updateLiveScore();})); const cv=$('#miniChart'); if(cv&&cv.getContext){const ctx=cv.getContext('2d'); const W=cv.width,H=cv.height; ctx.clearRect(0,0,W,H); const m=24,h=H-2*m,w=W-2*m; const xi=i=>m+(i/8)*w; const yi=v=>m+(1-v)*h; const rate=[0.2,0.22,0.25,0.28,0.35,0.5,0.55,0.52,0.48]; const loan=[0.55,0.56,0.58,0.57,0.53,0.48,0.44,0.43,0.45]; ctx.strokeStyle='rgba(80,140,255,0.9)'; ctx.lineWidth=2; ctx.beginPath(); rate.forEach((v,i)=>{const px=xi(i),py=yi(v); if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);}); ctx.stroke(); ctx.strokeStyle='rgba(100,220,150,0.9)'; ctx.beginPath(); loan.forEach((v,i)=>{const px=xi(i),py=yi(v); if(i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);}); ctx.stroke(); }}
    });

    // Init
    applyInitialTheme(); prefersDark.addEventListener?.('change',e=>{let s=null; try{s=localStorage.getItem(THEME_KEY);}catch(_){s=null;} if(s) return; setTheme(e.matches?'dark':'light',false);}); applySettings(); updateLiveScore();
  })();
  </script>
</body>
</html>
